(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{22:function(e,t,n){e.exports=n(34)},34:function(e,t,n){"use strict";n.r(t);var a=n(20),r=n(0),l=n.n(r),i=n(17),c=n.n(i);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o,u=n(38),m=(n(28),n(4)),s=n(7),p=n(6),d=n(2),h=n(5),E=n(13),f=n(39),v=n(37),b=n(33),g=n(36),y=n(12),O=n(21);window.addEventListener("unhandledrejection",function(e){e.reason instanceof w&&e.preventDefault()});var j,w=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(Object(O.a)(Error));!function(e){e.Text="text",e.Checkbox="checkbox"}(j||(j={}));var k,_=(o={},Object(y.a)(o,j.Text,"value"),Object(y.a)(o,j.Checkbox,"checked"),o),C=console.error;function S(e){return k._refresh(e)}var x=Object();var T={req:function(e,t,n){return fetch(e,{method:t,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(function(e){if(e.status>=400)throw new w(e.statusText);return e}).catch(function(e){return Promise.reject(new w(e))})},input:function(e,t,n){var a;if(void 0===e.state[t])throw new Error("bad name - ".concat(t," - ").concat(JSON.stringify(e.state)));var r=void 0===n?"value":_[n];return a={name:t,type:n},Object(y.a)(a,r,e.state[t]),Object(y.a)(a,"onChange",function(t){var n=t.target,a=Object(y.a)({},t.target.name,n[r]);return e.setState(a),a}),a},err:C,refresh:S,common:function(){return k._common()},setApp:function(e){k=e},unready:function(){S(x)},unready_o:x};function P(e){if(!D()){var t=e.Zi.id_token;T.req("/api/auth/login","POST",{id_token:t}).then(T.refresh)}}function q(){var e=window.gapi.auth2.getAuthInstance().signOut(),t=T.req("/api/auth/logout","POST");Promise.all([e,t]).then(T.refresh)}function D(){return void 0!==T.common().user.id}var I=function(){if(void 0===window.onSignIn){var e=document.getElementById("google-platform-preload"),t=document.createElement("script");t.src=e.href,document.head.appendChild(t),window.onSignIn=P}return l.a.createElement("div",null,l.a.createElement("meta",{name:"google-signin-client_id",content:T.common().google_signin_client_id}),l.a.createElement("div",{hidden:D(),id:"sign-in-button",className:"g-signin2","data-onsuccess":"onSignIn"}),D()&&l.a.createElement("div",null,l.a.createElement("button",{onClick:q},"Sign out"),l.a.createElement("br",null),l.a.createElement(g.a,{to:"/user/".concat(T.common().user.id)},"Profile")),T.common().user.is_admin&&l.a.createElement(g.a,{to:"/admin/user/latest"},"Latest Users"))},A={id:0,name:"",path:"",description:""},N=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){T.req("/api/admin/new_gym","POST",n.state).then(function(){return n.setState(A)}).then(T.refresh),e.preventDefault()},n.state=A,n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("p",null,"New Gym"),l.a.createElement("p",null,"path:"," ",l.a.createElement("input",T.input(this,"path",j.Text))),l.a.createElement("p",null,"name:"," ",l.a.createElement("input",T.input(this,"name",j.Text))),l.a.createElement("p",null,"description: ",l.a.createElement("textarea",T.input(this,"description"))),l.a.createElement("input",{type:"submit",onClick:this.submit}))}}]),t}(r.Component);var H=function(e){return l.a.createElement("div",null,l.a.createElement("div",null,"The Climbing App"),e.gyms.map(function(e){return l.a.createElement("p",{key:e.id},l.a.createElement(g.a,{to:"/gym/".concat(e.path)},e.name," | ",e.description))}),T.common().user.is_admin&&l.a.createElement(N,null))},W=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state=Object.assign({},e.user),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"checkboxProps",value:function(e){var t=this,n=Object.assign({},this.state),a=T.input(this,e,j.Checkbox),r=a.onChange,l=!T.common().user.is_admin;return Object.assign(a,{onChange:function(e){var a=r(e);return T.req("/api/admin/user/".concat(t.props.user.id,"/edit"),"POST",a).then(T.unready).catch(function(e){t.setState(n),T.err(e)}),a},disabled:l})}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(g.a,{to:"/"},"Home"),l.a.createElement("div",null,l.a.createElement("p",null,this.props.user.name),l.a.createElement("img",{src:this.props.user.image}),l.a.createElement("br",null),l.a.createElement("p",null,"is admin: ",l.a.createElement("input",this.checkboxProps("is_admin"))),l.a.createElement("p",null,"is verified:"," ",l.a.createElement("input",this.checkboxProps("is_verified")))))}}]),t}(r.Component);var B=function(e){return l.a.createElement("div",null,l.a.createElement(g.a,{to:"/"},"Home"),l.a.createElement("div",null,e.users.map(function(e){return l.a.createElement("div",{key:e.id},l.a.createElement("p",null,"id: ",e.id),l.a.createElement("p",null,"name: ",e.name),l.a.createElement("p",null,"email: ",e.email),l.a.createElement("p",null,"timestamp: ",e.timestamp),l.a.createElement("p",null,l.a.createElement(g.a,{to:"/user/".concat(e.id)},"Profile")))})))},J=function(e){function t(e){var n;Object(m.a)(this,t),n=Object(p.a)(this,Object(d.a)(t).call(this,e));var a={};return e.gym.walls.forEach(function(t){a[t.id]=-1!==e.gym.climbed_walls.indexOf(t.id)}),n.state=a,n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"checkboxProps",value:function(e){var t=this,n=T.input(this,e.toString(),j.Checkbox),a=n.onChange;return Object.assign(n,{onChange:function(n){n.preventDefault();var r=Object.assign({},t.state),l=a(n);return T.req("/api/".concat(T.common().path,"/wall/").concat(e,"/climb"),"POST",{climbed:l[e]}).then(T.unready).catch(function(e){t.setState(r),T.err(e)}),l}})}},{key:"render",value:function(){var e=this;return l.a.createElement("div",null,l.a.createElement(g.a,{to:"/"},"Home"),l.a.createElement("div",null,this.props.gym.name),l.a.createElement("div",null,this.props.gym.description),l.a.createElement("br",null),l.a.createElement("div",null,l.a.createElement("p",null,"Walls"),l.a.createElement("br",null),T.common().user.is_verified&&l.a.createElement(g.a,{to:"".concat(T.common().path,"/edit")},"Edit"),this.props.gym.walls.map(function(t){return l.a.createElement("div",{key:t.id},l.a.createElement(g.a,{to:"".concat(T.common().path,"/wall/").concat(t.id)},l.a.createElement("p",null,"id: ",t.id),l.a.createElement("p",null,"name: ",t.name),l.a.createElement("p",null,"difficulty: ",t.difficulty),l.a.createElement("p",null,"location: ",t.location),l.a.createElement("p",null,"date: ",t.date),l.a.createElement("p",null,"setter: ",t.setter),l.a.createElement("p",null,"color: ",t.color),l.a.createElement("p",null,"status: ",t.active?"active":"retired")),l.a.createElement("p",null,"climbed:"," ",l.a.createElement("input",e.checkboxProps(t.id))))})))}}]),t}(r.Component),z={id:0,name:"",difficulty:"",location:"",date:"",setter:"",color:"",active:!1},M=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){e.preventDefault(),T.req("/api/gym/".concat(n.props.gym_path,"/new_wall"),"POST",n.state).then(function(){return n.setState(z)}).then(T.refresh)},n.state=z,n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("p",null,"New Wall"),l.a.createElement("p",null,"name: ",l.a.createElement("input",T.input(this,"name"))),l.a.createElement("p",null,"difficulty: ",l.a.createElement("input",T.input(this,"difficulty"))),l.a.createElement("p",null,"location: ",l.a.createElement("input",T.input(this,"location"))),l.a.createElement("p",null,"date: ",l.a.createElement("input",T.input(this,"date"))),l.a.createElement("p",null,"setter: ",l.a.createElement("input",T.input(this,"setter"))),l.a.createElement("p",null,"color: ",l.a.createElement("input",T.input(this,"color"))),l.a.createElement("p",null,"active:"," ",l.a.createElement("input",T.input(this,"active",j.Checkbox))),l.a.createElement("input",{type:"submit",onClick:this.submit}))}}]),t}(r.Component),R=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){e.preventDefault(),T.req("/api/gym/".concat(n.props.gym_path,"/wall/").concat(n.props.id,"/edit"),"POST",n.state).then(T.refresh)},n.state=Object.assign({},e),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("p",null,"id: ",this.props.id),l.a.createElement("p",null,"name: ",l.a.createElement("input",T.input(this,"name"))),l.a.createElement("p",null,"difficulty: ",l.a.createElement("input",T.input(this,"difficulty"))),l.a.createElement("p",null,"location: ",l.a.createElement("input",T.input(this,"location"))),l.a.createElement("p",null,"date: ",l.a.createElement("input",T.input(this,"date"))),l.a.createElement("p",null,"setter: ",l.a.createElement("input",T.input(this,"setter"))),l.a.createElement("p",null,"color: ",l.a.createElement("input",T.input(this,"color"))),l.a.createElement("p",null,"active:"," ",l.a.createElement("input",T.input(this,"active",j.Checkbox))),l.a.createElement("input",{type:"submit",onClick:this.submit}))}}]),t}(r.Component),U=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){e.preventDefault(),T.req("/api/gym/".concat(n.props.gym.path,"/edit"),"POST",n.state).then(T.refresh)},n.state=Object.assign({},e.gym),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return l.a.createElement("div",null,l.a.createElement(g.a,{to:"/"},"Home"),l.a.createElement("div",null,l.a.createElement("p",null,"name: ",l.a.createElement("input",T.input(this,"name"))),l.a.createElement("p",null,"description:"," ",l.a.createElement("textarea",T.input(this,"description"))),l.a.createElement("input",{type:"submit",onClick:this.submit})),l.a.createElement("div",null,l.a.createElement("p",null,"Walls"),l.a.createElement("br",null),l.a.createElement(M,{gym_path:this.props.gym.path}),this.props.gym.walls.map(function(t){return l.a.createElement(R,Object.assign({gym_path:e.props.gym.path,key:t.id},t))})))}}]),t}(r.Component),L=l.a.createRef();function F(e){e.preventDefault();var t=L.current;if(null!==t){var n=t.files;if(n){var a,r=n[0],l=r.type.split("/")[0];if(-1===["image","video"].indexOf(l))return alert("invalid file");T.req("/api/get_gcs_key").then(function(e){return e.json()}).then(function(e){a=e.token;var t=e.folder,n=e.bucket,l="".concat(t,"/").concat((new Date).getTime(),"_").concat(r.name),i="https://www.googleapis.com/upload/storage/v1/b/".concat(n,"/o?uploadType=media&name=").concat(l);return fetch(i,{method:"POST",body:r,headers:{Authorization:"Bearer ".concat(a),"Content-Type":r.type}})}).then(function(e){return e.json()}).then(function(e){return T.req("/api/".concat(T.common().path,"/upload"),"POST",{gcs_path:e.name,gcs_id:e.id,mime:r.type,size:r.size,gcs_key:a})}).then(T.refresh)}}}var G=function(e){return l.a.createElement("div",null,l.a.createElement("p",null,"Media"),l.a.createElement("br",null),void 0===T.common().user.id?l.a.createElement("p",null,"Create an account and become verified to upload media."):T.common().user.is_verified?l.a.createElement("div",null,l.a.createElement("p",null,"New Media"),l.a.createElement("div",null,l.a.createElement("input",{ref:L,type:"file",name:"upload"}),l.a.createElement("input",{type:"submit",onClick:F}))):l.a.createElement("p",null,"Email climb.nomorerice@gmail.com to become verified to upload media."),l.a.createElement("div",null,e.media.map(function(e){return l.a.createElement("div",{key:e.id},l.a.createElement("p",null,"id: ",e.id),l.a.createElement("p",null,"mime: ",e.mime),function(e){if(e.data){if("video"===e.mime){var t=encodeURIComponent("https://www.facebook.com".concat(e.data));return l.a.createElement("iframe",{src:"https://www.facebook.com/plugins/video.php?href=".concat(t),width:e.width,height:e.height,style:{border:"none",overflow:"hidden"},scrolling:"no",allowFullScreen:!0})}return"image"===e.mime?l.a.createElement("img",{src:e.data}):l.a.createElement("pre",null,e.data)}return l.a.createElement("p",null,"received - handling")}(e))})))};var Z=function(e){return l.a.createElement("div",null,l.a.createElement(g.a,{to:"/"},"Home"),l.a.createElement("div",null,l.a.createElement("p",null,"id: ",e.wall.id),l.a.createElement("p",null,"name: ",e.wall.name),l.a.createElement("p",null,"difficulty: ",e.wall.difficulty),l.a.createElement("p",null,"location: ",e.wall.location),l.a.createElement("p",null,"date: ",e.wall.date),l.a.createElement("p",null,"setter: ",e.wall.setter),l.a.createElement("p",null,"color: ",e.wall.color),l.a.createElement("p",null,"status: ",e.wall.active?"active":"retired"),l.a.createElement(G,{media:e.wall.media})))};function $(e,t){return{exact:!0,path:e,render:function(e){return T.common().path===encodeURI(e.location.pathname)&&t(e.match.params)}}}var K=function(e){return l.a.createElement("div",null,l.a.createElement(I,null),l.a.createElement(v.a,null,l.a.createElement(b.a,$("/",function(){return l.a.createElement(H,{gyms:e.gyms})})),l.a.createElement(b.a,$("/admin/user/latest",function(){return l.a.createElement(B,{users:e.users})})),l.a.createElement(b.a,$("/user/:user_id",function(){return l.a.createElement(W,{user:e.user})})),l.a.createElement(b.a,$("/gym/:gym_path",function(){return l.a.createElement(J,{gym:e.gym})})),l.a.createElement(b.a,$("/gym/:gym_path/edit",function(){return l.a.createElement(U,{gym:e.gym})})),l.a.createElement(b.a,$("/gym/:gym_path/wall/:wall_id",function(){return l.a.createElement(Z,{wall:e.wall})}))))},Q=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e)))._refresh=function(e){var t=e===T.unready_o;return console.log("refresh",t,n.props.history.location.pathname),t&&n.setState({ready:!1}),T.req("/api".concat(n.props.history.location.pathname)).then(function(e){return e.json()}).then(function(e){return n.setState(Object.assign({ready:!0},e)),e})},n._common=function(){return n.state.common},n.state={ready:!1},T.setApp(Object(E.a)(Object(E.a)(n))),n.props.history.listen(T.unready),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){T.unready()}},{key:"render",value:function(){return this.state.ready?l.a.createElement(K,this.state):null}}]),t}(r.Component),V=Object(f.a)(Q),X=console.log;console.log=function(){var e=Array.from(arguments);return X.apply(void 0,Object(a.a)(e)),e[0]},c.a.render(l.a.createElement(u.a,null,l.a.createElement(V,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[22,2,1]]]);
//# sourceMappingURL=main.c1a80a60.chunk.js.map