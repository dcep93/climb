(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{2:function(e,t,n){e.exports={bubble:"globals_bubble__2iKJc",inline:"globals_inline__oEJv6",flex:"globals_flex__3XGsp",margin:"globals_margin__3fqZc",main:"globals_main__2uw_J"}},20:function(e,t,n){e.exports={align_end:"Auth_align_end__2AnBq",g_sign_in:"Auth_g_sign_in__2_TB9"}},21:function(e,t,n){e.exports={header:"Header_header__1HgZT",icon:"Header_icon__vHi87"}},26:function(e,t,n){e.exports={vertical_space:"GymEdit_vertical_space__1_IYS"}},27:function(e,t,n){e.exports={new_gym:"GymsAdmin_new_gym__3lGYi"}},28:function(e,t,n){e.exports={profile:"Profile_profile__36MGf"}},33:function(e,t,n){e.exports=n(57)},57:function(e,t,n){"use strict";n.r(t);var a=n(31),r=n(0),c=n.n(r),i=n(24),l=n.n(i);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var o,u=n(61),m=(n(39),n(5)),s=n(8),p=n(7),d=n(3),h=n(6),f=n(14),E=n(62),g=n(59),b=n(25),v=n.n(b),y=n(13),_=n(32);window.addEventListener("unhandledrejection",function(e){e.reason instanceof w&&e.preventDefault()});var O,w=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(h.a)(t,e),t}(Object(_.a)(Error));!function(e){e.Text="text",e.Checkbox="checkbox"}(O||(O={}));var j,k=(o={},Object(y.a)(o,O.Text,"value"),Object(y.a)(o,O.Checkbox,"checked"),o),x=console.error;function C(e){return j._refresh(e)}var T=Object();var S=function(e){function t(){var e,n;Object(m.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).componentDidMount=function(){document.title=n.props.title},n.render=function(){return null},n}return Object(h.a)(t,e),t}(r.Component),N={req:function(e,t,n){return fetch("/api".concat(e),{method:t,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then(function(e){if(e.status>=400)throw new w(e.statusText);return e}).catch(function(e){return Promise.reject(new w(e))})},input:function(e,t,n){var a;if(void 0===e.state[t])throw new Error("bad name - ".concat(t," - ").concat(JSON.stringify(e.state)));var r=void 0===n?"value":k[n];return a={name:t,type:n},Object(y.a)(a,r,e.state[t]),Object(y.a)(a,"onChange",function(t){var n=t.target,a=Object(y.a)({},t.target.name,n[r]);return e.setState(a),a}),a},err:x,refresh:C,common:function(){return j._common()},setApp:function(e){j=e},unready:function(){C(T)},unready_o:T,inputDate:function(e){return(void 0===e?new Date:new Date(e)).toISOString().slice(0,10)},Title:S},P=n(2),D=n.n(P),q=n(20),A=n.n(q);function I(e){if(!J()){var t=e.Zi.id_token;N.req("/auth/login","POST",{id_token:t}).then(N.unready)}}function G(){var e=window.gapi.auth2.getAuthInstance().signOut(),t=N.req("/auth/logout","POST");Promise.all([e,t]).then(N.unready)}function J(){return void 0!==N.common().user.id}var B=function(){if(void 0===window.onSignIn){var e=document.getElementById("google-platform-preload"),t=document.createElement("script");t.src=e.href,document.head.appendChild(t),window.onSignIn=I}return c.a.createElement("div",{className:A.a.align_end},c.a.createElement("meta",{name:"google-signin-client_id",content:N.common().google_signin_client_id}),c.a.createElement("div",{hidden:J(),id:"sign-in-button",className:"g-signin2 ".concat(A.a.g_sign_in),"data-onsuccess":"onSignIn"}),J()&&c.a.createElement("div",null,c.a.createElement(v.a,{onClick:G,variant:"primary"},"Sign out"),c.a.createElement(g.a,{to:"/user/".concat(N.common().user.id),className:D.a.margin},"Profile")))},M=n(21),H=n.n(M);var U=function(){return c.a.createElement("div",{className:"".concat(H.a.header," ").concat(D.a.bubble)},c.a.createElement(g.a,{to:"/"},c.a.createElement("img",{src:"/favicon.ico",className:H.a.icon})),N.common().user.is_admin&&c.a.createElement(g.a,{to:"/admin/user/latest",className:D.a.margin},"Latest Users"),c.a.createElement(B,null))},z=n(60),L=n(56);var R=function(e){function t(e){var n;Object(m.a)(this,t),n=Object(p.a)(this,Object(d.a)(t).call(this,e));var a={};return e.gym.walls.forEach(function(t){a[t.id]=-1!==e.gym.climbed_walls.indexOf(t.id)}),n.state=a,n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"checkboxProps",value:function(e){var t=this,n=N.input(this,e.toString(),O.Checkbox),a=n.onChange;return Object.assign(n,{onChange:function(n){var r=Object.assign({},t.state),c=a(n);return N.req("/gym/".concat(t.props.gym.path,"/wall/").concat(e,"/climb"),"POST",{climbed:c[e]}).then(N.refresh).catch(function(e){t.setState(r),N.err(e)}),c}})}},{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement(N.Title,{title:this.props.gym.name}),c.a.createElement("div",{className:D.a.margin},c.a.createElement("h2",null,this.props.gym.name),c.a.createElement("div",null,this.props.gym.description),N.common().user.is_verified&&c.a.createElement(g.a,{to:"".concat(this.props.gym.path,"/edit")},"Edit")),c.a.createElement("div",{className:D.a.flex},this.props.gym.walls.map(function(t){return c.a.createElement("div",{key:t.id,className:D.a.bubble},c.a.createElement(g.a,{to:"".concat(e.props.gym.path,"/wall/").concat(t.id)},c.a.createElement("h4",null,"".concat(t.name," (").concat(t.id,")"))),c.a.createElement("p",null,(n=t.date,new Date(n).toDateString())),c.a.createElement("p",null,t.difficulty),c.a.createElement("p",null,t.location),c.a.createElement("p",null,t.color),c.a.createElement("p",null,t.setter),c.a.createElement("p",null,t.active?"active":"retired"),c.a.createElement("p",null,"climbed:"," ",c.a.createElement("input",e.checkboxProps(t.id))));var n})))}}]),t}(r.Component),W=c.a.createRef();function Z(e,t){return void 0===N.common().user.id?c.a.createElement("p",null,"Create an account and become verified to upload media."):N.common().user.is_verified?c.a.createElement("div",null,c.a.createElement("p",null,"New Media"),c.a.createElement("div",null,c.a.createElement("input",{ref:W,type:"file",name:"upload"}),c.a.createElement("input",{type:"submit",onClick:function(n){return function(e,t,n){n.preventDefault();var a=W.current;if(null===a)return;var r=a.files;if(!r)return;var c,i=r[0],l=i.type.split("/")[0];if(-1===["image","video"].indexOf(l))return alert("invalid file");N.req("/get_gcs_key").then(function(e){return e.json()}).then(function(e){c=e.token;var t=e.folder,n=e.bucket,a="".concat(t,"/").concat((new Date).getTime(),"_").concat(i.name),r="https://www.googleapis.com/upload/storage/v1/b/".concat(n,"/o?uploadType=media&name=").concat(a);return fetch(r,{method:"POST",body:i,headers:{Authorization:"Bearer ".concat(c),"Content-Type":i.type}})}).then(function(e){return e.json()}).then(function(n){return N.req("/gym/".concat(e,"/wall/").concat(t,"/upload"),"POST",{gcs_path:n.name,gcs_id:n.id,mime:i.type,size:i.size,gcs_key:c})}).then(N.refresh)}(e,t,n)}}))):c.a.createElement("p",null,"Email climb.nomorerice@gmail.com to become verified to upload media.")}var Y=function(e){return c.a.createElement("div",null,c.a.createElement("p",null,"Media"),c.a.createElement("br",null),Z(e.gym_path,e.wall_id),c.a.createElement("div",null,e.media.map(function(e){return c.a.createElement("div",{key:e.id},c.a.createElement("p",null,"id: ",e.id),c.a.createElement("p",null,"mime: ",e.mime),function(e){if(e.data){if("video"===e.mime){var t=encodeURIComponent("https://www.facebook.com".concat(e.data));return c.a.createElement("iframe",{src:"https://www.facebook.com/plugins/video.php?href=".concat(t),width:e.width,height:e.height,style:{border:"none",overflow:"hidden"},scrolling:"no",allowFullScreen:!0})}return"image"===e.mime?c.a.createElement("img",{src:e.data}):c.a.createElement("pre",null,e.data)}return c.a.createElement("p",null,"received - handling")}(e))})))};var F=function(e){return c.a.createElement("div",null,c.a.createElement("div",{className:D.a.margin},c.a.createElement(g.a,{to:"/gym/".concat(e.wall.gym_path)},"To Gym Page")),c.a.createElement("div",{className:"".concat(D.a.bubble," ").concat(D.a.inline)},c.a.createElement("p",null,"id: ",e.wall.id),c.a.createElement("p",null,"name: ",e.wall.name),c.a.createElement("p",null,"difficulty: ",e.wall.difficulty),c.a.createElement("p",null,"location: ",e.wall.location),c.a.createElement("p",null,"date: ",new Date(e.wall.date).toDateString()),c.a.createElement("p",null,"setter: ",e.wall.setter),c.a.createElement("p",null,"color: ",e.wall.color),c.a.createElement("p",null,"status: ",e.wall.active?"active":"retired")),c.a.createElement("br",null),c.a.createElement(Y,{gym_path:e.wall.gym_path,wall_id:e.wall.id,media:e.wall.media}))},K={id:0,name:"",difficulty:"",location:"",date:"",setter:"",color:"",active:!0,gym_path:""},X=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){e.preventDefault(),N.req("/gym/".concat(n.props.gym_path,"/new_wall"),"POST",n.state).then(function(){return n.setState(K)}).then(N.refresh)},n.state=Object.assign({},K,{date:N.inputDate()}),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return c.a.createElement("div",{className:D.a.bubble},c.a.createElement("p",null,"New Wall"),c.a.createElement("p",null,"name: ",c.a.createElement("input",N.input(this,"name"))),c.a.createElement("p",null,"difficulty: ",c.a.createElement("input",N.input(this,"difficulty"))),c.a.createElement("p",null,"location: ",c.a.createElement("input",N.input(this,"location"))),c.a.createElement("p",null,"date: ",c.a.createElement("input",Object.assign({},N.input(this,"date"),{type:"date"}))),c.a.createElement("p",null,"setter: ",c.a.createElement("input",N.input(this,"setter"))),c.a.createElement("p",null,"color: ",c.a.createElement("input",N.input(this,"color"))),c.a.createElement("p",null,"active:"," ",c.a.createElement("input",N.input(this,"active",O.Checkbox))),c.a.createElement("input",{type:"submit",onClick:this.submit}))}}]),t}(r.Component),$=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){e.preventDefault();var t="/gym/".concat(n.props.gym_path,"/wall/").concat(n.props.id,"/edit");N.req(t,"POST",n.state).then(N.refresh)},n.state=Object.assign({},e,{date:N.inputDate(e.date)}),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return c.a.createElement("div",{className:D.a.bubble},c.a.createElement("p",null,"id: ",this.props.id),c.a.createElement("p",null,"name: ",c.a.createElement("input",N.input(this,"name"))),c.a.createElement("p",null,"difficulty: ",c.a.createElement("input",N.input(this,"difficulty"))),c.a.createElement("p",null,"location: ",c.a.createElement("input",N.input(this,"location"))),c.a.createElement("p",null,"date: ",c.a.createElement("input",Object.assign({},N.input(this,"date"),{type:"date"}))),c.a.createElement("p",null,"setter: ",c.a.createElement("input",N.input(this,"setter"))),c.a.createElement("p",null,"color: ",c.a.createElement("input",N.input(this,"color"))),c.a.createElement("p",null,"active:"," ",c.a.createElement("input",N.input(this,"active",O.Checkbox))),c.a.createElement("input",{type:"submit",onClick:this.submit}))}}]),t}(r.Component),Q=n(26),V=n.n(Q),ee=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){e.preventDefault(),N.req("/gym/".concat(n.props.gym.path,"/edit"),"POST",n.state).then(N.refresh)},n.state=Object.assign({},e.gym),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return c.a.createElement("div",null,c.a.createElement(N.Title,{title:"Edit: ".concat(this.props.gym.name)}),c.a.createElement("div",{className:D.a.margin},c.a.createElement(g.a,{to:"/gym/".concat(this.props.gym.path)},"To Gym Page"),c.a.createElement("div",{className:V.a.vertical_space}),c.a.createElement("p",null,"name: ",c.a.createElement("input",N.input(this,"name"))),c.a.createElement("p",null,"description:"," ",c.a.createElement("textarea",N.input(this,"description"))),c.a.createElement("input",{type:"submit",onClick:this.submit})),c.a.createElement("div",{className:D.a.flex},c.a.createElement(X,{gym_path:this.props.gym.path}),this.props.gym.walls.map(function(t){return c.a.createElement($,Object.assign({key:t.id,gym_path:e.props.gym.path},t))})))}}]),t}(r.Component),te=n(27),ne=n.n(te),ae={id:0,name:"",path:"",description:""},re=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).submit=function(e){N.req("/admin/new_gym","POST",n.state).then(function(){return n.setState(ae)}).then(N.refresh),e.preventDefault()},n.state=ae,n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return c.a.createElement("div",{className:"".concat(D.a.bubble," ").concat(ne.a.new_gym)},c.a.createElement("h3",null,"New Gym"),c.a.createElement("p",null,"path:"," ",c.a.createElement("input",N.input(this,"path",O.Text))),c.a.createElement("p",null,"name:"," ",c.a.createElement("input",N.input(this,"name",O.Text))),c.a.createElement("p",null,"description: ",c.a.createElement("textarea",N.input(this,"description"))),c.a.createElement("input",{type:"submit",onClick:this.submit}))}}]),t}(r.Component);var ce=function(e){return c.a.createElement("div",null,c.a.createElement(N.Title,{title:"The Climbing App"}),c.a.createElement("div",{className:D.a.flex},e.gyms.map(function(e){return c.a.createElement("div",{key:e.id,className:D.a.bubble},c.a.createElement(g.a,{to:"/gym/".concat(e.path)},c.a.createElement("h3",null,e.name),c.a.createElement("p",null,e.description)))})),N.common().user.is_admin&&c.a.createElement(re,null))};var ie=function(e){return c.a.createElement("div",null,c.a.createElement(N.Title,{title:"Latest Users"}),c.a.createElement("div",{className:D.a.flex},e.users.map(function(e){return c.a.createElement("div",{key:e.id,className:D.a.bubble},c.a.createElement(g.a,{to:"/user/".concat(e.id)},c.a.createElement("p",null,"id: ",e.id),c.a.createElement("p",null,"name: ",e.name),c.a.createElement("p",null,"email: ",e.email),c.a.createElement("p",null,"timestamp: ",e.timestamp),c.a.createElement("img",{src:e.image})))})))},le=n(28),oe=n.n(le),ue=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e))).state=Object.assign({},e.user),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"checkboxProps",value:function(e){var t=this,n=Object.assign({},this.state),a=N.input(this,e,O.Checkbox),r=a.onChange,c=!N.common().user.is_admin;return Object.assign(a,{onChange:function(e){var a="/admin/user/".concat(t.props.user.id,"/edit"),c=r(e);return N.req(a,"POST",c).then(N.unready).catch(function(e){t.setState(n),N.err(e)}),c},disabled:c})}},{key:"render",value:function(){return c.a.createElement("div",{className:"".concat(D.a.bubble," ").concat(oe.a.profile)},c.a.createElement(N.Title,{title:this.props.user.name}),c.a.createElement("div",null,c.a.createElement("p",null,this.props.user.name),c.a.createElement("img",{src:this.props.user.image})),c.a.createElement("div",null,c.a.createElement("p",null,"is admin: ",c.a.createElement("input",this.checkboxProps("is_admin"))),c.a.createElement("p",null,"is verified:"," ",c.a.createElement("input",this.checkboxProps("is_verified")))))}}]),t}(r.Component);function me(e,t){return{exact:!0,path:e,render:function(e){return N.common().path===encodeURI(e.location.pathname)&&t(e.match.params)}}}var se=function(e){return c.a.createElement("div",null,c.a.createElement(z.a,null,c.a.createElement(L.a,me("/",function(){return c.a.createElement(ce,{gyms:e.gyms})})),c.a.createElement(L.a,me("/admin/user/latest",function(){return c.a.createElement(ie,{users:e.users})})),c.a.createElement(L.a,me("/user/:user_id",function(){return c.a.createElement(ue,{user:e.user})})),c.a.createElement(L.a,me("/gym/:gym_path",function(){return c.a.createElement(R,{gym:e.gym})})),c.a.createElement(L.a,me("/gym/:gym_path/edit",function(){return c.a.createElement(ee,{gym:e.gym})})),c.a.createElement(L.a,me("/gym/:gym_path/wall/:wall_id",function(){return c.a.createElement(F,{wall:e.wall})}))))};var pe=function(e){return c.a.createElement("div",{className:D.a.main},c.a.createElement(U,null),c.a.createElement(se,e))},de=function(e){function t(e){var n;return Object(m.a)(this,t),(n=Object(p.a)(this,Object(d.a)(t).call(this,e)))._refresh=function(e){var t=e===N.unready_o;return console.log("refresh",t,n.props.history.location.pathname),t&&location.reload(),N.req("".concat(n.props.history.location.pathname)).then(function(e){return e.json()}).then(function(e){return n.setState(Object.assign({ready:!0},e)),e})},n._common=function(){return n.state.common},n.state={ready:!1},N.setApp(Object(f.a)(Object(f.a)(n))),n.props.history.listen(N.refresh),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){N.refresh()}},{key:"render",value:function(){return this.state.ready?c.a.createElement(pe,this.state):null}}]),t}(r.Component),he=Object(E.a)(de),fe=console.log;console.log=function(){var e=Array.from(arguments);return fe.apply(void 0,Object(a.a)(e)),e[0]},l.a.render(c.a.createElement(u.a,null,c.a.createElement(he,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[33,2,1]]]);
//# sourceMappingURL=main.53aeec9a.chunk.js.map